<!DOCTYPE html>
<html lang="ko"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="www.thymeleaf.org"
      layout:decorate="~{layout/base.html}">
<head>
  <meta charset="UTF-8">
  <title>등록 페이지</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link th:href="@{/css/order.css}" rel="stylesheet">
</head>
<body>
<div layout:fragment="content">
  <main>
    <div class="order-container">
      <h2>수거 정보</h2>
      <table id="orderItemsTable" class="order-table">
        <thead>
        <tr>
          <th>제품정보</th>
          <th>결제 금액</th>
        </tr>
        </thead>
        <tbody id="classifiedItems">
        <!-- 분류된 항목들이 여기 추가됩니다 -->
        </tbody>
      </table>

      <form th:action="@{/echopickup/product/order}" th:object="${member}" method="post">
<!--      <form action="/echopickup/product/order" method="post">-->
        <div class="form-group">
          <label for="name">신청인</label>
          <input type="text" id="name" name="name" placeholder="이름을 입력하세요" value="${member.mname}">
        </div>
        <div class="form-group">
          <label for="phone">휴대전화</label>
          <div class="phone-input">
            <input type="tel" id="phone" name="phone" placeholder="01012345678" value="${member.phone}">
          </div>
        </div>
        <div class="form-group">
          <label for="date">수거 예정일</label>
          <input type="date" id="date" name="date">
        </div>
        <div class="form-group">
          <label for="address">주소</label>
          <input type="text" id="address" name="address" placeholder="주소를 입력하세요" value="${member.address}">
          <input type="hidden" id="postcode" placeholder="우편번호">
          <button type="button" class="find-address-btn" onclick="DaumPostcode()">우편번호</button>
        </div>
        <div class="form-group">
          <label for="detailAddress">상세 주소</label>
          <input type="text" id="detailAddress" name="detailAddress" placeholder="상세 주소를 입력하세요">
        </div>

        <h2>총 주문금액</h2>
        <div class="order-summary">
<!--          <div class="summary-item">-->
<!--            <span>주문금액</span><span>34,000원</span>-->
<!--          </div>-->
<!--          <div class="summary-item">-->
<!--            <span>배송비</span><span>무료</span>-->
<!--          </div>-->
          <div class="summary-item total">
            <span>최종 결제금액</span><span>0원</span>
          </div>
        </div>

        <div class="action-buttons">
          <button type="button" class="cancel-btn">취소</button>
          <button type="submit" class="order-btn">결제하기</button>
        </div>
      </form>
    </div>

    <script th:src="@{/js/order.js}"></script>
    <script>
      // 주소 관련 함수
      function DaumPostcode() {
        new daum.Postcode({
          oncomplete: function(data) {
            // 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.
            // 각 주소의 노출 규칙에 따라 주소를 조합한다.
            // 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
            var addr = ''; // 주소 변수

            //사용자가 선택한 주소 타입에 따라 해당 주소 값을 가져온다.
            if (data.userSelectedType === 'R') { // 사용자가 도로명 주소를 선택했을 경우
              addr = data.roadAddress;
            } else { // 사용자가 지번 주소를 선택했을 경우(J)
              addr = data.jibunAddress;
            }

            // 우편번호와 주소 정보를 해당 필드에 넣는다.
            document.getElementById('postcode').value = data.zonecode;
            document.getElementById("address").value = addr;
            // 커서를 상세주소 필드로 이동한다.
            document.getElementById("detailAddress").focus();
          }
        }).open();
      }
      // 주소 작성 후 최종 합치기
      // 각 input 필드의 값이 변경될 때마다 주소를 업데이트하는 함수
      function updateFullAddress() {
        var postcode = document.getElementById('postcode').value;
        var address = document.getElementById('address').value;
        var detailAddress = document.getElementById('detailAddress').value;

        // 연결할 문자열 생성
        var fullAddress = '('  + postcode + ')' + ' ' + address + ' ' + detailAddress;
      }

      // 각 input 필드에 change 이벤트 리스너 추가
      document.getElementById('postcode').addEventListener('input', updateFullAddress);
      document.getElementById('address').addEventListener('input', updateFullAddress);
      document.getElementById('detailAddress').addEventListener('input', updateFullAddress);
    </script>
  </main>
</div>
</body>
</html>